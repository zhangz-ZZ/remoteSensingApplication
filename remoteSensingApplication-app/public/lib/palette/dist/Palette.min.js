/*! worldview-app 2017-04-27 */

function Palette(){function a(){void 0!=d.m_BeginJson.single&&(d.single_data=d.m_BeginJson.single,d.single_Num=d.single_data.length)}function b(){void 0!=d.m_BeginJson.gradient&&(e=d.m_BeginJson.gradient,f=e.length,g=e[0][0],h=e[f-1][0])}function c(){if(void 0!=d.m_BeginJson.range){for(var a=d.m_BeginJson.range,b=0;b<a.length;b++){var c=a[b];2==c.length&&k.push(c)}l=k.length}}var d=this;d.target_div="",d.target_div_ID="",d.m_BeginJson={},d.unit="",this.init_palette=function(a,b){d.target_div_ID=a,d.target_div=document.getElementById(a),d.m_BeginJson=b,i()&&(j(),m())},d.palette_Mode="default",d.single_data=[];var e=[];d.single_Num=0;var f=0,g=0,h=0,i=function(){if(void 0==d.target_div)return console.log("当前初始化调色板部件为空："+d.target_div_ID),!1;if(void 0==d.m_BeginJson.palette_mode)return console.log("调色板控件json格式错误：palette_mode 不能为空。"),!1;switch(d.m_BeginJson.palette_mode){case"single":if(void 0==d.m_BeginJson.single)return console.log("调色板控件json格式错误：single 不能为空。"),!1;break;case"gradient":if(void 0==d.m_BeginJson.gradient)return console.log("调色板控件json格式错误：gradient 不能为空。"),!1;break;case"range":if(void 0==d.m_BeginJson.range)return console.log("调色板控件json格式错误：range 不能为空。"),!1;break;default:return console.log("调色板控件json格式错误：palette_mode 需要为single gradient range中的一个。"),!1}return!0},j=function(){switch(void 0!=d.m_BeginJson.unit&&(d.unit=d.m_BeginJson.unit),d.m_BeginJson.palette_mode){case"single":d.palette_Mode="single",a();break;case"gradient":d.palette_Mode="gradient",b();break;case"range":d.palette_Mode="range",c();break;default:d.palette_Mode="unknown",console.log("当前模式未知："+d.m_BeginJson.palette_mode)}},k=[],l=0,m=function(){var a="";switch(d.palette_Mode){case"single":a=n();break;case"gradient":a=s();break;case"range":a=y();break;default:console.log("当前模式未知："+d.palette_Mode)}var b=A(),c=a+b+"</div>";switch(d.target_div.innerHTML=c,d.palette_Mode){case"single":o();break;case"gradient":x();try{t()}catch(a){console.log(a)}break;case"range":try{z()}catch(a){console.log(a)}break;default:console.log("当前模式未知："+d.palette_Mode)}},n=function(){var a='<div id="Show_Color_plate" style="width: 100%;height: 100%;overflow: hidden;">';if(d.single_Num>0)for(var b=0;b<d.single_Num;b++){var c=d.single_data[b],e=c[1],f="rgb("+e[0]+","+e[1]+","+e[2]+")",g=c[2],h='<canvas style="width: 20px; height: 20px; position: relative;   border:1px solid #404040;margin: 2px; float:left;background-color: '+f+';"title="'+g+'"id="single_canvas_'+b+'"class="single_canvas_'+d.target_div_ID+'"></canvas>';a+=h}return a},o=function(){for(var a=document.getElementsByClassName("single_canvas_"+d.target_div_ID),b=0;b<a.length;b++)a[b].onmouseover=p,a[b].onmouseout=q,a[b].onmousemove=r},p=function(a){var b=a.currentTarget,c=b.style.backgroundColor,e=b.title;document.getElementById(d.detail_canvas_id).style.backgroundColor=c,document.getElementById(d.detail_a_id).innerHTML=e+d.unit,document.getElementById(d.detail_id).style.display="block"},q=function(a){document.getElementById(d.detail_id).style.display="none"},r=function(a){var b=$("#"+d.target_div_ID).width();a.offsetX,a.currentTarget.offsetLeft;a.offsetX+a.currentTarget.offsetLeft+10+100<b?$("#"+d.detail_id).css({top:a.currentTarget.offsetTop-5+"px",left:a.offsetX+a.currentTarget.offsetLeft+10+"px"}):$("#"+d.detail_id).css({top:a.currentTarget.offsetTop-5+"px",left:a.offsetX+a.currentTarget.offsetLeft-10-100+"px"})};d.gradient_id="",d.gradient_canvas_id="";var s=function(){return d.gradient_id=d.target_div_ID+"_gradient",d.gradient_canvas_id=d.target_div_ID+"_gradient_canvas","<div id='"+d.gradient_id+"'><canvas style='width: 100%;height:10px;border:1px solid #404040;' id='"+d.gradient_canvas_id+"' title=''> </canvas><div style='width:100%;height: 12px; margin-top:-5px;font-size: 8px;'><p style='float: left;'>"+g.toFixed(2)+"</p><p style='float: right;'>"+h.toFixed(2)+"</p></div>"},t=function(){var a=document.getElementById(d.gradient_canvas_id);a.onmouseover=u,a.onmouseout=v,a.onmousemove=w},u=function(a){document.getElementById(d.detail_id).style.display="block"},v=function(a){document.getElementById(d.detail_id).style.display="none"},w=function(a){var b=document.getElementById(d.gradient_canvas_id),c=$("#"+d.target_div_ID).width(),e=b.getBoundingClientRect(),f=(a.clientX-e.left)*(b.width/e.width);b.style.cursor="pointer";var i=b.getContext("2d"),j=i.getImageData(f,2,1,1),k="rgb("+j.data[0]+","+j.data[1]+","+j.data[2]+")";document.getElementById(d.detail_canvas_id).style.background=k;var l=document.getElementById(d.detail_a_id),m=a.clientX-e.left;l.innerHTML=(g+(h-g)/c*m).toFixed(2)+d.unit,a.offsetX+a.currentTarget.offsetLeft+10+100<c?$("#"+d.detail_id).css({top:a.currentTarget.offsetTop-5+"px",left:a.offsetX+a.currentTarget.offsetLeft+10+"px"}):$("#"+d.detail_id).css({top:a.currentTarget.offsetTop-5+"px",left:a.offsetX+a.currentTarget.offsetLeft-10-100+"px"})},x=function(){var a=document.getElementById(d.gradient_canvas_id),b=a.width,c=a.height,g=a.getContext("2d"),h=g.createLinearGradient(0,0,b,0);if(f>1)for(var i=0;i<f;i++){var j=e[i][1],k="rgb("+j[0]+", "+j[1]+", "+j[2]+")";h.addColorStop(1/(f-1)*i,k)}else{var j=e[0][1],k="rgb("+j[0]+", "+j[1]+", "+j[2]+")";h.addColorStop(0,k),h.addColorStop(1,k)}g.fillStyle=h,g.fillRect(0,0,b,c)},y=function(){var a=$("#"+d.target_div_ID).width(),b=19;l>0&&(b=(a-2)/l,(a-2)/l>0&&(a-2)/l<b&&(b=(a-2)/l));var c='<div id="Show_Color_plate" style="width: 100%"><div>';if(l>0)for(var e=0;e<l;e++){var f=k[e],g=f[1],h="rgb("+g[0]+","+g[1]+","+g[2]+")",i=f[0][0],j=f[0][1];null==i&&(i=""),null==j&&(j="");var m=i+"~"+j;m.replace("null","--");var n='<div><canvas style="width: '+b+"px; height: 14px; float: left; border:0px solid #404040;margin: 2px 0px;background-color: "+h+';"title="'+m+'"class="range_canvas_'+d.target_div_ID+'"></canvas></div>';c+=n}if(l>0){var o=k[0][0][0],p=k[k.length-1][0][1];void 0!=o&&null!=o||(o="<"+k[0][0][1]),void 0!=p&&null!=p||(p=+k[k.length-1][0][0]+"<"),c=c+"</div><div style='width:100%;height: 12px; margin-top:-6px;font-size: 8px;'><p style='float: left;'>"+o+"</p><p style='float: right;'>"+p+"</p></div>"}return c+="</div>"},z=function(){for(var a=document.getElementsByClassName("range_canvas_"+d.target_div_ID),b=0;b<a.length;b++)a[b].onmouseover=p,a[b].onmouseout=q,a[b].onmousemove=r},A=function(){return d.detail_id=d.target_div_ID+"_detail",d.detail_canvas_id=d.target_div_ID+"_detail_canvas",d.detail_a_id=d.target_div_ID+"_detail_a",' \x3c!--悬浮显示部分DIV --\x3e<div id="'+d.detail_id+'"style="background-color: white; width: 100px;height: 25px; position:absolute; border: 1px solid #7d7d7d;display:none;"><canvas style="width: 19px;height: 19px;float: left;background-color: #ffffff;margin: 2px;"id="'+d.detail_canvas_id+'"></canvas><p id="'+d.detail_a_id+'"style="height: 25px;line-height: 25px;color:#000000;float:left;overflow:hidden;"> </p></div>'}}